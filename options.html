<!DOCTYPE html>
<html>
  <head>
    <title>Times Set Helper - Options</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="css/options.css" />
  </head>
  <body>
    <div class="container">
      <div class="header-section">
        <h1>Manage Time Entries</h1>
        <div class="settings-gear-buttons">
          <button
            id="openRedmineSettings"
            class="settings-gear-button"
            title="Redmine API Settings"
          >
            âš™ï¸
          </button>
          <button
            id="openJiraSettings"
            class="settings-gear-button"
            title="Jira Connection Settings"
          >
            ğŸ”—
          </button>
          <button
            id="openTempoSettings"
            class="settings-gear-button"
            title="Tempo Timesheets Settings"
          >
            ğŸ•
          </button>
        </div>
      </div>

      <!-- Calendar component -->
      <div id="calendar" class="calendar">
        <div class="calendar-header">
          <button id="prevWeek" class="calendar-nav">â€¹</button>
          <h3 id="weekDisplay">Week of December 16, 2024</h3>
          <button id="nextWeek" class="calendar-nav">â€º</button>
          <button id="toggleCalendarView" class="calendar-toggle">ğŸ“…</button>
        </div>
        <div class="calendar-grid" id="calendarGrid">
          <div class="calendar-day-header">Mon</div>
          <div class="calendar-day-header">Tue</div>
          <div class="calendar-day-header">Wed</div>
          <div class="calendar-day-header">Thu</div>
          <div class="calendar-day-header">Fri</div>
          <div class="calendar-day-header">Sat</div>
          <div class="calendar-day-header">Sun</div>
          <!-- Calendar days will be generated by JavaScript -->
        </div>
        <div class="calendar-legend">
          <div class="legend-item">
            <div class="legend-color hours-low"></div>
            <span>&lt;6h</span>
          </div>
          <div class="legend-item">
            <div class="legend-color hours-normal"></div>
            <span>6-8h</span>
          </div>
          <div class="legend-item">
            <div class="legend-color hours-high"></div>
            <span>&gt;8h</span>
          </div>
        </div>
      </div>

      <!-- Redmine Settings Modal -->
      <div id="redmineModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>ğŸ”§ Redmine API Configuration</h3>
            <span class="close" id="closeRedmineModal">&times;</span>
          </div>
          <div class="modal-body">
            <div class="settings-section">
              <h4>ğŸŒ Connection Settings</h4>
              <div class="input-group-modern">
                <label for="redmineUrl">
                  <span class="label-icon">ğŸ”—</span>
                  Redmine URL
                </label>
                <input
                  type="url"
                  id="redmineUrl"
                  placeholder="https://your-redmine.com"
                  class="modern-input"
                />
              </div>
              <div class="input-group-modern">
                <label for="redmineApiKey">
                  <span class="label-icon">ğŸ”‘</span>
                  API Key
                </label>
                <input
                  type="password"
                  id="redmineApiKey"
                  placeholder="Your Redmine API key"
                  class="modern-input"
                />
                <div class="input-help">
                  You can find your API key in your Redmine account settings
                </div>
              </div>
            </div>

            <div class="settings-section">
              <div class="advanced-toggle">
                <button type="button" id="toggleAdvanced" class="toggle-button">
                  <span class="toggle-icon">â–¶</span>
                  Advanced Settings
                </button>
              </div>
              <div id="advancedSettings" class="advanced-content">
                <div class="input-group-modern">
                  <label for="redmineProjectId">
                    <span class="label-icon">ğŸ“</span>
                    Default Project ID
                  </label>
                  <input
                    type="number"
                    id="redmineProjectId"
                    placeholder="1"
                    class="modern-input"
                  />
                  <div class="input-help">
                    Optional: Default project ID for new entries
                  </div>
                </div>
                <div class="input-group-modern">
                  <label for="redmineActivityId">
                    <span class="label-icon">âš¡</span>
                    Default Activity ID
                  </label>
                  <input
                    type="number"
                    id="redmineActivityId"
                    placeholder="9"
                    class="modern-input"
                  />
                  <div class="input-help">
                    Activity ID for regular work entries
                  </div>
                </div>
                <div class="input-group-modern">
                  <label for="redmineResearchActivityId">
                    <span class="label-icon">ğŸ”¬</span>
                    Research Activity ID
                  </label>
                  <input
                    type="number"
                    id="redmineResearchActivityId"
                    placeholder="46"
                    class="modern-input"
                  />
                  <div class="input-help">Activity ID for research entries</div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="testRedmineConnection" class="btn-secondary">
              ğŸ” Test Connection
            </button>
            <button id="saveRedmineSettings" class="btn-primary">
              ğŸ’¾ Save Settings
            </button>
            <button id="cancelRedmineSettings" class="btn-cancel">
              âŒ Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Jira Settings Modal -->
      <div id="jiraModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>ğŸ”— Jira Connection Settings</h3>
            <span class="close" id="closeJiraModal">&times;</span>
          </div>
          <div class="modal-body">
            <div class="settings-section">
              <h4>ğŸŒ Connection Settings</h4>
              <div class="input-group-modern">
                <label for="jiraUrl">
                  <span class="label-icon">ğŸ”—</span>
                  Jira URL
                </label>
                <input
                  type="url"
                  id="jiraUrl"
                  placeholder="https://your-company.atlassian.net"
                  class="modern-input"
                />
              </div>
              <div class="input-group-modern">
                <label for="jiraProject">
                  <span class="label-icon">ğŸ“</span>
                  Link to Redmine Project
                </label>
                <select id="jiraProject" class="modern-input">
                  <option value="">Select Redmine project...</option>
                </select>
                <button
                  type="button"
                  id="refreshJiraProjects"
                  class="btn-secondary"
                >
                  ğŸ”„ Refresh Projects
                </button>
                <div class="input-help">
                  Select which Redmine project to link with this Jira instance
                </div>
              </div>
              <div class="input-group-modern">
                <label for="jiraDefaultProject">
                  <span class="label-icon">ğŸ“</span>
                  Default Redmine Project for new tasks
                </label>
                <select id="jiraDefaultProject" class="input-modern">
                  <option value="">Select project...</option>
                </select>
                <div class="input-help">
                  Project where new Redmine tasks will be created from Jira
                </div>
              </div>

              <div class="input-group-modern">
                <label class="checkbox-label">
                  <input type="checkbox" id="jiraAutoDetect" />
                  <span class="label-icon">ğŸ”</span>
                  Auto-detect Redmine links in Jira tasks
                </label>
                <div class="input-help">
                  Automatically scan Jira task descriptions for Redmine links
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="saveJiraSettings" class="btn-primary">
              ğŸ’¾ Save Settings
            </button>
            <button id="cancelJiraSettings" class="btn-cancel">
              âŒ Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Tempo Settings Modal -->
      <div id="tempoModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>ğŸ• Tempo Timesheets Configuration</h3>
            <span class="close" id="closeTempoModal">&times;</span>
          </div>
          <div class="modal-body">
            <div class="settings-section">
              <h4>ğŸŒ Connection Settings</h4>
              <div class="input-group-modern">
                <label for="tempoApiToken">
                  <span class="label-icon">ğŸ”‘</span>
                  Tempo API Token
                </label>
                <input
                  type="password"
                  id="tempoApiToken"
                  placeholder="Your Tempo API token"
                  class="modern-input"
                />
                <div class="input-help">
                  Get your API token from Tempo Settings â†’ API Integration
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h4>ğŸ“Š Export Options</h4>
              <div class="input-group-modern">
                <label class="checkbox-label">
                  <input type="checkbox" id="tempoAutoExport" />
                  <span class="label-icon">ğŸ“¤</span>
                  Auto-export monthly data
                </label>
                <div class="input-help">
                  Automatically export Tempo data at the end of each month
                </div>
              </div>
              <div class="input-group-modern">
                <label for="tempoExportFormat">
                  <span class="label-icon">ğŸ“„</span>
                  Export Format
                </label>
                <select id="tempoExportFormat" class="modern-input">
                  <option value="json">JSON</option>
                  <option value="csv">CSV</option>
                </select>
                <div class="input-help">
                  Default format for exporting Tempo data
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="testTempoConnection" class="btn-secondary">
              ğŸ” Test Connection
            </button>
            <button id="exportTempoData" class="btn-secondary">
              ğŸ“¤ Export Current Month
            </button>
            <button id="saveTempoSettings" class="btn-primary">
              ğŸ’¾ Save Settings
            </button>
            <button id="cancelTempoSettings" class="btn-cancel">
              âŒ Cancel
            </button>
          </div>
        </div>
      </div>

      <div class="table-section">
        <h2>Saved Entries</h2>
        <table id="tasksTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Task ID / Project</th>
              <th>Hours</th>
              <th>Comment</th>
              <th>Research</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="timesTable">
            <!-- Entries will be added here dynamically -->
          </tbody>
        </table>
        <div id="noTasksMessage" class="no-tasks" style="display: none">
          No time entries added yet.
        </div>
      </div>

      <!-- Add Entry Form (hidden by default) -->
      <div id="addEntryForm" class="form-section" style="display: none">
        <div class="form-group">
          <h2 id="formTitle">Add New Time Entry</h2>
          <input type="hidden" id="editDayIndex" />
          <input type="hidden" id="editTimeIndex" />

          <div class="form-row">
            <div class="input-group">
              <label for="date">Date:</label>
              <input type="date" id="date" required />
            </div>
            <div class="input-group">
              <label for="task">Task ID:</label>
              <input type="text" id="task" placeholder="e.g., 76218" />
            </div>
            <div class="input-group">
              <label for="project">Project:</label>
              <div class="select-box">
                <select id="project" disabled>
                  <option value="">Select project...</option>
                </select>
                <button type="button" id="refreshProjects" disabled>ğŸ”„</button>
              </div>
            </div>
            <div class="input-group">
              <label for="time">Hours:</label>
              <input
                type="number"
                id="time"
                min="0.5"
                max="24"
                step="0.5"
                value="8"
                required
              />
            </div>
            <div class="input-group checkbox">
              <input type="checkbox" id="isResearch" />
              <label for="isResearch">Is Research?</label>
            </div>
          </div>
          <div class="form-row">
            <div class="input-group comment-group">
              <label for="comment">Comment:</label>
              <textarea id="comment" placeholder="Optional comment"></textarea>
            </div>
            <div class="form-buttons">
              <button id="addEntry">Add Entry</button>
              <button id="updateEntry" style="display: none">
                Update Entry
              </button>
              <button id="cancelEdit" style="display: none">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <div class="bulk-actions">
        <div class="import-export-section">
          <input
            type="file"
            id="importFile"
            accept=".json"
            style="display: none"
          />
          <button id="importBtn">Import from JSON</button>
          <button id="exportBtn">Export to JSON</button>
        </div>
        <div class="add-entry-section">
          <button id="toggleAddEntry" class="add-entry-button">
            <span class="add-icon">+</span>
            Add New Time Entry
          </button>
          <button id="fillViaAPI">Fill via API</button>
          <button id="clearAll">Clear All Data</button>
        </div>
      </div>
    </div>
    <script type="module" src="js/options.js"></script>
  </body>
</html>
