<!DOCTYPE html>
<html>
  <head>
    <title>Times Set Helper - Options</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="css/options.css" />
  </head>
  <body>
    <div class="container">
      <div class="header-section">
        <h1>Manage Time Entries</h1>
        <div class="settings-gear-buttons">
          <button
            id="openRedmineSettings"
            class="settings-gear-button"
            title="Redmine API Settings"
          >
            ‚öôÔ∏è
          </button>
          <button
            id="openJiraSettings"
            class="settings-gear-button"
            title="Jira Connection Settings"
          >
            üîó
          </button>
          <button
            id="openTempoSettings"
            class="settings-gear-button"
            title="Tempo Timesheets Settings"
          >
            üïê
          </button>
        </div>
      </div>

      <!-- Calendar component --
      <div id="calendar" class="calendar">
        <div class="calendar-header">
          <button id="prevWeek" class="calendar-nav">‚Äπ</button>
          <h3 id="weekDisplay">Week of December 16, 2024</h3>
          <button id="nextWeek" class="calendar-nav">‚Ä∫</button>
          <button id="toggleCalendarView" class="calendar-toggle">üìÖ</button>
        </div>
        <div class="calendar-grid" id="calendarGrid">
          <div class="calendar-day-header">Mon</div>
          <div class="calendar-day-header">Tue</div>
          <div class="calendar-day-header">Wed</div>
          <div class="calendar-day-header">Thu</div>
          <div class="calendar-day-header">Fri</div>
          <div class="calendar-day-header">Sat</div>
          <div class="calendar-day-header">Sun</div>
          <!-- Calendar days will be generated by JavaScript --
        </div>
        <div class="calendar-legend">
          <div class="legend-item">
            <div class="legend-color hours-low"></div>
            <span>&lt;6h</span>
          </div>
          <div class="legend-item">
            <div class="legend-color hours-normal"></div>
            <span>6-8h</span>
          </div>
          <div class="legend-item">
            <div class="legend-color hours-high"></div>
            <span>&gt;8h</span>
          </div>
        </div>
      </div> -->

      <!-- Redmine Settings Modal -->
      <div id="redmineModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>üîß Redmine API Configuration</h3>
            <span class="close" id="closeRedmineModal">&times;</span>
          </div>
          <div class="modal-body">
            <div class="settings-section">
              <h4>üåê Connection Settings</h4>
              <div class="input-group-modern">
                <label for="redmineUrl">
                  <span class="label-icon">üîó</span>
                  Redmine URL
                </label>
                <input
                  type="url"
                  id="redmineUrl"
                  placeholder="https://your-redmine.com"
                  class="modern-input"
                />
              </div>
              <div class="input-group-modern">
                <label for="redmineApiKey">
                  <span class="label-icon">üîë</span>
                  API Key
                </label>
                <input
                  type="password"
                  id="redmineApiKey"
                  placeholder="Your Redmine API key"
                  class="modern-input"
                />
                <div class="input-help">
                  You can find your API key in your Redmine account settings
                </div>
              </div>
            </div>

            <div class="settings-section">
              <div class="advanced-toggle">
                <button type="button" id="toggleAdvanced" class="toggle-button">
                  <span class="toggle-icon">‚ñ∂</span>
                  Advanced Settings
                </button>
              </div>
              <div id="advancedSettings" class="advanced-content">
                <div class="input-group-modern">
                  <label for="redmineProjectId">
                    <span class="label-icon">üìÅ</span>
                    Default Project ID
                  </label>
                  <input
                    type="number"
                    id="redmineProjectId"
                    placeholder="1"
                    class="modern-input"
                  />
                  <div class="input-help">
                    Optional: Default project ID for new entries
                  </div>
                </div>
                <div class="input-group-modern">
                  <label for="redmineActivityId">
                    <span class="label-icon">‚ö°</span>
                    Default Activity ID
                  </label>
                  <input
                    type="number"
                    id="redmineActivityId"
                    placeholder="9"
                    class="modern-input"
                  />
                  <div class="input-help">
                    Activity ID for regular work entries
                  </div>
                </div>
                <div class="input-group-modern">
                  <label for="redmineResearchActivityId">
                    <span class="label-icon">üî¨</span>
                    Research Activity ID
                  </label>
                  <input
                    type="number"
                    id="redmineResearchActivityId"
                    placeholder="46"
                    class="modern-input"
                  />
                  <div class="input-help">Activity ID for research entries</div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="testRedmineConnection" class="btn-secondary">
              üîç Test Connection
            </button>
            <button id="saveRedmineSettings" class="btn-primary">
              üíæ Save Settings
            </button>
            <button id="cancelRedmineSettings" class="btn-cancel">
              ‚ùå Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Jira Settings Modal -->
      <div id="jiraModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>üîó Jira Connection Settings</h3>
            <span class="close" id="closeJiraModal">&times;</span>
          </div>
          <div class="modal-body">
            <div class="settings-section">
              <h4>üåê API Connection</h4>
              <div class="input-group-modern">
                <label for="jiraUrl">
                  <span class="label-icon">üîó</span>
                  Jira Instance URL
                </label>
                <input
                  type="url"
                  id="jiraUrl"
                  placeholder="https://your-company.atlassian.net"
                  class="modern-input"
                />
                <div class="input-help">
                  Your Jira Cloud or Server instance URL
                </div>
              </div>
              <div class="input-group-modern">
                <label for="jiraEmail">
                  <span class="label-icon">üìß</span>
                  Email Address
                </label>
                <input
                  type="email"
                  id="jiraEmail"
                  placeholder="your-email@company.com"
                  class="modern-input"
                />
                <div class="input-help">
                  Your Jira account email (for API token authentication)
                </div>
              </div>
              <div class="input-group-modern">
                <label for="jiraApiToken">
                  <span class="label-icon">üîë</span>
                  API Token
                </label>
                <input
                  type="password"
                  id="jiraApiToken"
                  placeholder="Your Jira API token"
                  class="modern-input"
                />
                <div class="input-help">
                  <a
                    href="https://id.atlassian.com/manage-profile/security/api-tokens"
                    target="_blank"
                  >
                    üîó Create API Token
                  </a>
                  (Recommended for security)
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h4>üîß Advanced Settings</h4>
              <div class="input-group-modern">
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    id="jiraEnabled"
                    class="modern-checkbox"
                  />
                  <span class="label-icon">‚úÖ</span>
                  Enable Jira Integration
                </label>
                <div class="input-help">
                  Enable enhanced time comparison with Jira task mapping
                </div>
              </div>
              <div class="input-group-modern">
                <label for="jiraDefaultProject">
                  <span class="label-icon">üìÅ</span>
                  Default Redmine Project
                </label>
                <select id="jiraDefaultProject" class="modern-input">
                  <option value="">Select project...</option>
                </select>
                <div class="input-help">
                  Default project for creating Redmine tasks from unmapped Jira
                  issues
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h4>üîó Project Mappings</h4>
              <div class="input-help">
                Map JIRA instances to Redmine projects for automatic project selection
              </div>
              
              <div class="mappings-container">
                <div class="mappings-header">
                  <button id="addJiraMapping" class="btn-secondary">
                    ‚ûï Add Mapping
                  </button>
                </div>
                
                <div id="jiraMappingsTable" class="mappings-table">
                  <!-- Mappings will be populated by JavaScript -->
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h4>üìä Connection Status</h4>
              <div id="jiraConnectionStatus" class="connection-status">
                <span class="status-indicator">‚ö™</span>
                <span class="status-text">Not tested</span>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="testJiraConnection" class="btn-primary">
              üîç Test Connection
            </button>
            <button id="saveJiraSettings" class="btn-primary">
              üíæ Save Settings
            </button>
            <button id="cancelJiraSettings" class="btn-cancel">
              ‚ùå Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Tempo Settings Modal -->
      <div id="tempoModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>üïê Tempo Timesheets Configuration</h3>
            <span class="close" id="closeTempoModal">&times;</span>
          </div>
          <div class="modal-body">
            <div class="settings-section">
              <h4>üåê Connection Settings</h4>
              <div class="input-group-modern">
                <label for="tempoApiToken">
                  <span class="label-icon">üîë</span>
                  Tempo API Token
                </label>
                <input
                  type="password"
                  id="tempoApiToken"
                  placeholder="Your Tempo API token"
                  class="modern-input"
                />
                <div class="input-help">
                  Get your API token from Tempo Settings ‚Üí API Integration
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h4>üìä Export Options</h4>
              <div class="input-group-modern">
                <label class="checkbox-label">
                  <input type="checkbox" id="tempoAutoExport" />
                  <span class="label-icon">üì§</span>
                  Auto-export monthly data
                </label>
                <div class="input-help">
                  Automatically export Tempo data at the end of each month
                </div>
              </div>
              <div class="input-group-modern">
                <label for="tempoExportFormat">
                  <span class="label-icon">üìÑ</span>
                  Export Format
                </label>
                <select id="tempoExportFormat" class="modern-input">
                  <option value="json">JSON</option>
                  <option value="csv">CSV</option>
                </select>
                <div class="input-help">
                  Default format for exporting Tempo data
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="testTempoConnection" class="btn-secondary">
              üîç Test Connection
            </button>
            <button id="exportTempoData" class="btn-secondary">
              üì§ Export Current Month
            </button>
            <button id="saveTempoSettings" class="btn-primary">
              üíæ Save Settings
            </button>
            <button id="cancelTempoSettings" class="btn-cancel">
              ‚ùå Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- JIRA Mapping Modal -->
      <div id="jiraMappingModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="jiraMappingModalTitle">üîó Add JIRA Project Mapping</h3>
            <span class="close" id="closeJiraMappingModal">&times;</span>
          </div>
          <div class="modal-body">
            <form id="jiraMappingForm">
              <input type="hidden" id="mappingId" />
              
              <div class="input-group-modern">
                <label for="mappingJiraUrl">
                  <span class="label-icon">üîó</span>
                  JIRA Instance URL
                </label>
                <input
                  type="url"
                  id="mappingJiraUrl"
                  placeholder="https://your-company.atlassian.net"
                  class="modern-input"
                  required
                />
                <div class="input-help">
                  Base URL of the JIRA instance (without specific project paths)
                </div>
              </div>
              
              <div class="input-group-modern">
                <label for="mappingRedmineProject">
                  <span class="label-icon">üìÅ</span>
                  Redmine Project
                </label>
                <select id="mappingRedmineProject" class="modern-input" required>
                  <option value="">Select project...</option>
                </select>
                <div class="input-help">
                  Redmine project to link with this JIRA instance
                </div>
              </div>
              
              <div class="input-group-modern">
                <label for="mappingDescription">
                  <span class="label-icon">üìù</span>
                  Description (Optional)
                </label>
                <input
                  type="text"
                  id="mappingDescription"
                  placeholder="e.g., Main development JIRA"
                  class="modern-input"
                />
                <div class="input-help">
                  Optional description to help identify this mapping
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button id="saveMappingBtn" class="btn-primary">
              üíæ Save Mapping
            </button>
            <button id="cancelMappingBtn" class="btn-cancel">
              ‚ùå Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Simple Time Comparison Section -->
      <div id="simpleTimeComparisonSection" class="comparison-section">
        <h2>‚öñÔ∏è –ü—Ä–æ—Å—Ç–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (Tempo vs Redmine)</h2>
        <p class="section-description">
          –ü—Ä–æ—Å—Ç–æ–µ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É Tempo –∏ Redmine.
          –ë–µ–∑ –ª–∏—à–Ω–µ–π —Ö—É–π–Ω–∏ - –ø—Ä–æ—Å—Ç–æ –Ω–∞—Ö–æ–¥–∏–º —á—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
        </p>

        <div class="comparison-controls">
          <div class="control-group">
            <label for="simpleComparisonYear">–ì–æ–¥:</label>
            <select id="simpleComparisonYear" class="modern-select">
              <!-- Years will be populated by JavaScript -->
            </select>
          </div>

          <div class="control-group">
            <label for="simpleComparisonMonth">–ú–µ—Å—è—Ü:</label>
            <select id="simpleComparisonMonth" class="modern-select">
              <!-- Months will be populated by JavaScript -->
            </select>
          </div>

          <button id="simpleCompareButton" class="btn-primary">
            üîç –°—Ä–∞–≤–Ω–∏—Ç—å –≤—Ä–µ–º—è
          </button>
        </div>

        <!-- Results Container -->
        <div id="simpleComparisonResults" class="comparison-results" style="display: none">
          <!-- Summary -->
          <div id="simpleComparisonSummary" class="comparison-summary-container">
            <!-- Summary will be populated by JavaScript -->
          </div>

          <!-- Missing Entries -->
          <div id="simpleMissingEntries" class="missing-entries-container">
            <!-- Missing entries will be populated by JavaScript -->
          </div>

          <!-- Action Buttons -->
          <div class="comparison-actions">
            <button id="simpleCreateAllButton" class="btn-primary" disabled>
              ‚ö° –°–æ–∑–¥–∞—Ç—å –≤—Å—ë
            </button>
            <button id="simpleExportButton" class="btn-secondary" disabled>
              üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
            </button>
          </div>
        </div>
      </div>

      <!-- Old Time Comparison Section (commented out) -->
      <!-- 
      <div class="comparison-section">
        <h2>‚öñÔ∏è Time Comparison (Tempo vs Redmine)</h2>
        <p class="section-description">
          Compare time entries between Tempo and Redmine to find missing entries
          and discrepancies.
        </p>

        <div class="comparison-controls">
          <div class="control-group">
            <label for="comparisonYear">Year:</label>
            <select id="comparisonYear" class="modern-select">
              <!-- Years will be populated by JavaScript -->
            </select>
          </div>

          <div class="control-group">
            <label for="comparisonMonth">Month:</label>
            <select id="comparisonMonth" class="modern-select">
              <!-- Months will be populated by JavaScript -->
            </select>
          </div>

          <div class="control-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                id="enableEnhancedComparison"
                class="modern-checkbox"
              />
              <span class="label-icon">üîó</span>
              Enhanced Comparison with Jira Tasks
            </label>
            <div class="input-help">
              Map Tempo entries to Jira tasks and find linked Redmine issues for
              better recommendations
            </div>
          </div>

          <button id="compareTimeEntries" class="btn-primary">
            üîç Compare Time Entries
          </button>
        </div>

        <!-- Results Container -->
        <div
          id="comparisonResults"
          class="comparison-results"
          style="display: none"
        >
          <!-- Summary -->
          <div id="comparisonSummary" class="comparison-summary-container">
            <!-- Summary will be populated by JavaScript -->
          </div>

          <!-- Missing Entries -->
          <div id="missingEntries" class="missing-entries-container">
            <!-- Missing entries will be populated by JavaScript -->
          </div>

          <!-- Discrepancies -->
          <div id="discrepancies" class="discrepancies-container">
            <!-- Discrepancies will be populated by JavaScript -->
          </div>

          <!-- Date Comparison -->
          <div id="dateComparison" class="date-comparison-container">
            <!-- Date comparison will be populated by JavaScript -->
          </div>

          <!-- Action Buttons -->
          <div class="comparison-actions">
            <button id="exportMissingEntries" class="btn-secondary" disabled>
              üìÑ Export Missing Entries (CSV)
            </button>
            <button id="createRedmineEntries" class="btn-primary" disabled>
              ‚ûï Create Missing Entries in Redmine
            </button>
          </div>
        </div>
      </div>
      -->
      <!-- 
      <div class="table-section">
        <h2>Saved Entries</h2>
        <table id="tasksTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Task ID / Project</th>
              <th>Hours</th>
              <th>Comment</th>
              <th>Research</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="timesTable">
            <!-- Entries will be added here dynamically --
          </tbody>
        </table>
        <div id="noTasksMessage" class="no-tasks" style="display: none">
          No time entries added yet.
        </div>
      </div>

      <!-- Add Entry Form (hidden by default) --
      <div id="addEntryForm" class="form-section" style="display: none">
        <div class="form-group">
          <h2 id="formTitle">Add New Time Entry</h2>
          <input type="hidden" id="editDayIndex" />
          <input type="hidden" id="editTimeIndex" />

          <div class="form-row">
            <div class="input-group">
              <label for="date">Date:</label>
              <input type="date" id="date" required />
            </div>
            <div class="input-group">
              <label for="task">Task ID:</label>
              <input type="text" id="task" placeholder="e.g., 76218" />
            </div>
            <div class="input-group">
              <label for="project">Project:</label>
              <div class="select-box">
                <select id="project" disabled>
                  <option value="">Select project...</option>
                </select>
                <button type="button" id="refreshProjects" disabled>üîÑ</button>
              </div>
            </div>
            <div class="input-group">
              <label for="time">Hours:</label>
              <input
                type="number"
                id="time"
                min="0.5"
                max="24"
                step="0.5"
                value="8"
                required
              />
            </div>
            <div class="input-group checkbox">
              <input type="checkbox" id="isResearch" />
              <label for="isResearch">Is Research?</label>
            </div>
          </div>
          <div class="form-row">
            <div class="input-group comment-group">
              <label for="comment">Comment:</label>
              <textarea id="comment" placeholder="Optional comment"></textarea>
            </div>
            <div class="form-buttons">
              <button id="addEntry">Add Entry</button>
              <button id="updateEntry" style="display: none">
                Update Entry
              </button>
              <button id="cancelEdit" style="display: none">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <div class="bulk-actions">
        <div class="import-export-section">
          <input
            type="file"
            id="importFile"
            accept=".json"
            style="display: none"
          />
          <button id="importBtn">Import from JSON</button>
          <button id="exportBtn">Export to JSON</button>
        </div>
        <div class="add-entry-section">
          <button id="toggleAddEntry" class="add-entry-button">
            <span class="add-icon">+</span>
            Add New Time Entry
          </button>
          <button id="fillViaAPI">Fill via API</button>
          <button id="clearAll">Clear All Data</button>
        </div>
      </div>
    </div> -->
    <script type="module" src="js/options/index.js"></script>
  </body>
</html>
